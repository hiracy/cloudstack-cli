#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'cloudstack-bootstrap'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do |name|
    cb = Cloudstack::Bootstrap::Cli.new
    if options[:interactive]
      cb.interactive
    else
      cb.bootstrap_server(
        name,
        options[:zone],
        options[:template],
        options[:offering],
        [options[:network]],
        options[:ports],
        options[:project]
      ) 
    end
  end

  description 'Bootstrapping Cloudstack servers in the command line'

  arg :name, "Server name"

  on("-z ZONE", "--zone", "The Availability Zone name")
  on("-t TEMPLATE", "--template", "The template name")
  on("-o OFFERING", "--offering", "The computing offering name")
  on("-n NETWORK", "--network", "The network offering name")
  on("--project PROJECT", "The project name")
  on("-p PORTS", "--ports", "Portforwarding rules (comma seperated)")
  on("-i", "--interactive", "Run in interactive mode")
  on("--stack-file FILE", "The stack configuration file to use")

  version Cloudstack::Bootstrap::VERSION
  use_log_level_option
  go!
end
